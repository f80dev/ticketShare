<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minimal store sample</title>
</head>

<body onload="run()">
<p>Dans cette page, vous n'êtes plus dans KEREBUS mais dans une billeterie minimal visant à illustrer l'usage de l'API
add_ticket permetant d'intégrer des billets dans la blockchain</p>
<table style="width:100vw;">
  <tr>
    <th>Exemple minimaliste de boutique</th>
    <th>Procédure</th>
  </tr>
  <tr>
    <td style="width: 300px;text-align: left;vertical-align:top;" >
      <form id="frm">
        <div>
          <label for="email">Email</label>
          <input name="email" id="email" value="paul.dudule@gmail.com">
        </div>
        <br>
        <div>
          <label for="tickets">Combien de billets</label>
          <input name="tickets" type="number" size="3" id="tickets" value="2" max="10" min="0">
        </div>
        <br>
        <div>
          <label for="price">Prix</label>
          <input name="price" type="number" id="price" value="30" max="300" min="0">
        </div>
        <br>
        <div>
          <label for="date">Date</label>
          <input name="date" type="date" id="date" value="2021-01-01">
        </div>

        <div>
          <br>
        </div>
      </form>

      <button onclick="send()">Commander</button>
    </td>
    <td>
      <iframe id="faq" src="https://app.kerberus.tech/faqs.html?faq=extern_store"
              style="border:none;overflow:hidden;min-height:500px;width:100%;background: none;"></iframe>
    </td>
  </tr>
</table>
</body>

<script>
  function getParam() {
    var vars = {};
    window.location.href.replace(location.hash, '').replace(/[?&]+([^=&]+)=?([^&]*)?/gi, function (m, key, value) { vars[key] = value !== undefined ? value : ''; });
    return vars;
  }

  /**
   * Fonction appelée à l'ouverture de la page
   */
  function run(){
    //faq consiste à afficher de l'aide
    if(!getParam().hasOwnProperty("faq") || screen.availWidth<500)
      document.getElementById("faq").style.display="none";

    //permet un pré-remplissage de l'identité du client
    if(getParam().hasOwnProperty("email"))
      document.getElementById("email").value=getParam().email;
  }


  /**
   * Fonction appelée pour créer le billet
   */
  function send(){
    var idevent=getParam().idevent;
    if(idevent==null)idevent=0;

    var domain=getParam().domain;
    if(domain==null)domain="http://localhost:6800";

    var access_token=getParam().access_token;
    if(access_token==null)access_token="tkhh4271!!";

    var url=domain+"/api/add_ticket/+idevent";
    url=url.replace("http//","http://").replace("https//","https://");
    fetch(url,
      {
        body: new FormData(document.getElementById('frm')),
        method: "post",
        mode: 'no-cors',
        headers:{
          "access_token":access_token
        }
      }).then(function (r) {
        r.json().then(function (resp) {
        location.href=resp.data.redirect;
      });
    },function(r) {
      console.log(r);
    });
  }
</script>

</html>
