
    <div style="padding:1%;">

      <!--Zone de filtre-->
      <div style="width: 100%;text-align: left;" *ngIf="message.length==0">

        <button class="app-button" style="margin-top: 10px;" mat-button mat-raised-button
                (click)="fictif()">
          Evénement fictif
        </button>
        &nbsp;
        <!--<button class="app-button" style="margin-top: 10px;" mat-button mat-raised-button-->
                <!--(click)="job()">-->
          <!--Execute-->
        <!--</button>-->
        &nbsp; &nbsp;

        <div style="display: inline-block;" *ngIf="events?.length>2">
          <mat-form-field style="width:200px;" >
            <mat-label>Trier par</mat-label>
            <mat-select [(value)]="sortField" (valueChange)="refresh()">
              <mat-option value="dtCreate">Date de fabrication</mat-option>
              <mat-option value="state">Status</mat-option>
              <mat-option value="dtStart">Première date</mat-option>
              <mat-option value="dtEnd">Dernière date</mat-option>
            </mat-select>
          </mat-form-field>
          &nbsp;
          <mat-form-field style="width: 200px;">
            <mat-label>Filtrer</mat-label>
            <mat-select [(value)]="filterField">
              <mat-option *ngFor="let tag of tags" [value]="tag">{{tag}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <button class="app-button" style="margin-top: 10px;" mat-button mat-raised-button
                *ngIf="sortField?.length>0 || filterField?.length>0"
                (click)="clearFilter()">
          Pas de filtre
        </button>

      </div>


      <div style="width: 100%;display: flex;flex-wrap: wrap;text-align: center;" *ngIf="events.length>0">
        <app-event [message]="event.treatment" *ngFor="let event of events | filter: ['tags',filterField]" [event]="event" width="100%" style="display: inline-block;">

          <div *ngIf="event.state=='draft' && event.owner==config.user?.address"
               style="width:100%;text-align: left;overflow: hidden;">
            <div *ngIf="event.error!=null"><h4>Vérifier votre événement avant de le mettre en ligne :</h4></div>

            <span *ngIf="event.error!=null" style="color:red;">
              Erreur détectée : {{event.error.message}} (Code: {{event.error.code}})<br>
            </span>
            <br>
            <!--<ngx-json-viewer [json]="event" [expanded]="false"></ngx-json-viewer>-->
          </div>


          <div *ngIf="state=='online' && (event.preview || event.owner!=config.user?.address)">
            <div *ngIf="event.description?.length>0" style="font-size: small;color:gray;height: 200px;overflow: hidden;">
              {{event.description}}
            </div>
          </div>

          <div *ngIf="!event.preview && event.owner==config.user?.address" style="height:200px;">
            Il reste <br><br>
            <table style="width:100%;text-align: center;">
              <tr *ngFor="let r of event.rows">
                <td>
                  {{r.free}}
                </td>
                <td>
                  places à
                </td>
                <td>
                  {{r.price}}€
                </td>
              </tr>
            </table>

          </div>

          <div style="margin-top: 10px;text-align: center;width: 100%;" *ngIf="event.state=='online'">
            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.checkers?.indexOf(config.user?.address)==-1"
                    (click)="buy(event)">
              Acheter
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address && !event.preview"
                    (click)="preview(event)">
              Preview
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address && event.preview"
                    (click)="sales(event)">
              Ventes
            </button>

             <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address"
                    (click)="ongraph(event)">
              Graph
             </button>

             <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address"
                    (click)="cancel(event)">
              Annuler
             </button>


            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.checkers?.indexOf(config.user?.address)>-1"
                    (click)="validate(event)">
              Valider
            </button>
          </div>

          <app-hourglass [message]="event.treatment" [canCancel]="true" (cancel)="onCancel(event)"></app-hourglass><br>

          <div style="margin-top: 10px;text-align: center;width: 100%;" *ngIf="event.state=='draft'">
            <button class="app-button" mat-button mat-flat-button (click)="publish(event)">Publier</button>
            <button class="app-button" mat-button mat-flat-button (click)="delete(event)">Supprimer</button>
          </div>


        </app-event>
      </div>

      <app-hourglass [message]="message"></app-hourglass>

      <div *ngIf="events.length==0 && message.length==0">
        <br><br>
        Aucun événement disponible pour l'instant<br><br>
      </div>
    </div>
