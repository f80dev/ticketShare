
    <div class="mainform">

      <!--Zone de filtre-->

        <button class="app-button" style="margin-top: 10px;"
                mat-button mat-raised-button
                (click)="router.navigate(['eventeditor'])">
          Créer votre événement
        </button>

        <div style="display: inline-block;" *ngIf="events?.length>2">
          <mat-form-field style="width:200px;" >
            <mat-label>Trier par</mat-label>
            <mat-select [(value)]="sortField">
              <mat-option value="dtCreate">Date de fabrication</mat-option>
              <mat-option value="state">Status</mat-option>
              <mat-option value="name">Titre</mat-option>
              <mat-option value="dtStart">Première date</mat-option>
              <mat-option value="dtEnd">Dernière date</mat-option>
            </mat-select>
          </mat-form-field>
          &nbsp;
          <mat-form-field style="width: 200px;">
            <mat-label>Filtrer</mat-label>
            <mat-select [(value)]="filterField">
              <mat-option *ngFor="let tag of tags" [value]="tag">#{{tag}}</mat-option>
            </mat-select>
          </mat-form-field>
          <button class="app-button" style="margin-top: 10px;" mat-icon-button mat-button mat-raised-button
                  (click)="reduceAll()">
            <mat-icon>arrow_drop_up</mat-icon>
          </button>
        </div>

        <button class="app-button" style="margin-top: 10px;" mat-button mat-raised-button
                *ngIf="sortField?.length>0 || filterField?.length>0 || filterEvent!=null"
                (click)="clearFilter()">
          Tout voir
        </button>


      <div style="width: 100%;display: flex;flex-wrap: wrap;text-align: center;" *ngIf="events.length>0">
        <app-event [message]="event.treatment"
                   *ngFor="let event of events | filter: ['tags',filterField] | orderBy: sortField:'asc'"
                   [event]="event"
                   [expanded]="event.expanded"
                   width="100%"
                   style="display: inline-block;">

          <div *ngIf="event.state=='draft' && event.owner==config.user?.address"
               style="width:100%;text-align: left;overflow: hidden;">
            <div *ngIf="event.error!=null"><h4>Vérifier votre événement avant de le mettre en ligne :</h4></div>

            <span *ngIf="event.error!=null" style="color:red;">
              Erreur détectée : {{event.error.message}} (Code: {{event.error.code}})<br>
            </span>
          </div>

          <ngx-json-viewer *ngIf="event.showData==true"
                           style="text-align: left;"
                           [json]="event"
                           [expanded]="false">
          </ngx-json-viewer>

          <div *ngIf="event.state=='online' && (event.preview || event.owner!=config.user?.address)">

            <div *ngIf="event.htags?.length>1">
              <small>{{event.htags}}</small><br>
            </div>


            <div *ngIf="event.description?.length>0" style="font-size: small;color:gray;height: 200px;overflow: hidden;">
              {{event.description}}
            </div>

            <span *ngIf="event.dtStart!=event.dtEnd">
              Du {{event.dtStart*1000 | date:'dd/MM'}} au {{event.dtEnd*1000 | date:'dd/MM'}}
            </span>

            <span *ngIf="event.dtStart==event.dtEnd">
              le {{event.dtStart*1000 | date:'dd/MM/yy'}}
            </span>
          </div>

          <div *ngIf="!event.preview && event.owner==config.user?.address" style="height:200px;">
            Il reste <br><br>
            <table style="width:100%;text-align: center;">
              <tr *ngFor="let r of event.rows">
                <td>
                  {{r.free}}
                </td>
                <td>
                  places à
                </td>
                <td>
                  {{r.price}}€
                </td>
              </tr>
            </table>

          </div>

          <div style="margin-top: 10px;text-align: center;width: 100%;" *ngIf="event.state=='online'">
            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.checkers?.indexOf(config.user?.address)==-1"
                    (click)="buy(event)">
              Acheter
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.checkers?.indexOf(config.user?.address)==-1 && event.website?.length>0"
                    (click)="openWeb(event.website)">
              En savoir plus
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address && !event.preview"
                    (click)="preview(event)">
              Preview
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address && event.preview"
                    (click)="sales(event)">
              Ventes
            </button>

            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address"
                    (click)="showData(event)">
              Détail
            </button>

             <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address && event.state=='close'"
                    (click)="ongraph(event)">
              Graph
             </button>

             <button class="app-button" mat-button mat-flat-button
                     ngxClipboard [cbContent]="event.share_link"
                    (click)="share(event)">
              Partager
             </button>

             <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.owner==config.user?.address"
                    (click)="cancel(event)">
              Annuler
             </button>


            <button class="app-button" mat-button mat-flat-button
                    *ngIf="event.checkers?.indexOf(config.user?.address)>-1"
                    ngxClipboard [cbContent]="event.validate_link"
                    (click)="validate(event)">
              Valider
            </button>
          </div>

          <app-hourglass [message]="event.treatment" [canCancel]="true" (cancel)="onCancel(event)"></app-hourglass><br>

          <!--Rechargement-->

          <div style="margin-top: 10px;text-align: center;width: 100%;" *ngIf="event.state=='draft'">

            <div *ngIf="event.cost>0" style="width:90%;display: inline-block;text-align: center;">
              Frais de publication : {{event.cost}} €<br>

              <div *ngIf="config.user.account<event.cost">
                Solde insuffisant pour publier l'événement<br>
                <app-refund [items]="[{name: 'Rechargement',unit_amount: {currency_code: 'EUR',value: ''},quantity: '1',description:'Rechargement pour création d\'événement'}]"
                            [amounts]="[event.cost-config.user.account]"
                            [sandbox]="config.user.offer=='pilote'"
                            (payment)="onpayment($event)">
                </app-refund>
                <br>
              </div>
            </div>


            <button class="app-button" mat-button mat-flat-button *ngIf="config.user.account>=event.cost" (click)="publish(event)">Publier</button>
            <button class="app-button" mat-button mat-flat-button (click)="delete(event)">Supprimer</button>
            <button class="app-button" mat-button mat-flat-button *ngIf="config.user.email?.length>0"
                    (click)="receiveByMail(event,config.user.email)">
              Utiliser
            </button>
          </div>


        </app-event>
      </div>



      <div *ngIf="events.length==0 && message.length==0">
        <br><br>
        Aucun événement disponible pour l'instant<br><br>
      </div>
    </div>
