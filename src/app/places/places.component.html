<div style="min-width:400px;margin-left:5px;">

  <app-hourglass [message]="message"></app-hourglass>

  <!--Panel de commande-->
  <div *ngIf="message?.length==0" style="width: 100%;height:40px;">
    <table><tr>
      <td>
          <mat-icon (click)="router.navigate(['home'])" style="cursor: pointer;">arrow_back_ios</mat-icon>
      </td>
      <td>
        <button class="app-button" mat-button mat-flat-button
                *ngIf="total>0"
                style="background-color: darkred;color:white;"
                class="app-button" (click)="buy()">
          &nbsp;&nbsp;Acheter &nbsp;&nbsp;
        </button>
        &nbsp;&nbsp;
      </td>
      <td>
        <span *ngIf="nb_places>0">{{nb_places}} places</span>
        <span *ngIf="total>0">&nbsp;pour un total de {{total}}€</span>
        <span *ngIf="total>0 && etherprice>0">, soit {{total/etherprice | number:'1.1-3'}} ether</span>
      </td>
    </tr></table>
    <br>
  </div>

  <!--Zone de filtre-->
  <div style="width: 100%;text-align: center;" *ngIf="cats!=null && message.length==0">
    <mat-form-field style="width:200px;">
      <mat-label>Date</mat-label>
      <mat-select [(value)]="selectDate" (valueChange)="refresh()">
        <mat-option *ngFor="let dt of _dates" [value]="dt">
          {{dt*1000| date:'dd/MM/yyyy'}} à {{dt*1000| date:'HH:mm'}}
        </mat-option>
      </mat-select>
    </mat-form-field>
    &nbsp;
    <mat-form-field style="width: 200px;">
      <mat-label>Catégorie</mat-label>
      <mat-select [(value)]="selectCategorie">
        <mat-option *ngFor="let cat of cats" [value]="cat.value">
          {{cat.description}} ({{cat.value}}€)
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Pour l'instant désigne le systeme de sélection des billets unitaires-->
  <!--<div *ngIf="tickets?.length>0 && message?.length==0" style="margin:10px;">-->
  <!--<h3>Billets placées</h3>-->
  <!--<mat-selection-list #select>-->
  <!--<mat-list-option *ngFor="let ticket of tickets"-->
  <!--[value]="ticket._id"-->
  <!--(click)="update_total(select?.selectedOptions?.selected)">-->
  <!--<mat-icon matListIcon>event_seat</mat-icon>-->
  <!--<h3 matLine>Place {{ticket.seat}}</h3>-->
  <!--<p matLine>{{ticket.description}}</p>-->
  <!--<p matLine>-->
  <!--<span>{{ticket.price}}</span>€-->
  <!--<mat-icon style="cursor: pointer;display: inline-block;" ngxClipboard [cbContent]="ticket.address">copy</mat-icon>-->
  <!--</p>-->
  <!--</mat-list-option>-->
  <!--</mat-selection-list>-->
  <!--</div>-->


  <div *ngIf="l_categories.length>0 && message.length==0 && selectDate!=null"
       style="margin: 1%;width:100%;">

    <mat-grid-list
      [cols]="breakpoint"
      rowHeight="150px"
      (window:resize)="onResize($event)"
      style="width: 90%;max-width:1200px;">

      <div *ngFor="let cat of l_categories">

        <div *ngIf="selectCategorie=='*' || cat==selectCategorie"
             style="text-align: left;">

          <mat-grid-tile>
            <div *ngIf="categories[cat].to_buy>0">
              <img [src]="categories[cat].visual" style="max-width:400px;;object-fit: cover;">
            </div>
          </mat-grid-tile>

          <mat-grid-tile style="text-align: left;line-height: 95%;vertical-align: text-top;" *ngIf="categories[cat].to_buy>0">
            <table style="width:80%;max-width:600px;text-align: center;vertical-align: top;"><tr>
              <td style="width: 50%;">
                <strong>{{categories[cat].description}}</strong><br>
                <small>{{categories[cat].to_buy-categories[cat].buy}} places disponibles<br></small>
                Prix {{cat}}€
              </td>
              <td>
                <mat-form-field style="width: 100px;">
                  <mat-label>Acheter</mat-label>
                  <mat-select [(value)]="categories[cat].buy" (valueChange)="update_total()">
                    <mat-option *ngFor="let i of categories[cat].range" [value]="i">
                      {{i}} place<span *ngIf="i>1">s</span>
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
            </tr></table>
          </mat-grid-tile>
        <br>
        </div>
      </div>

    </mat-grid-list>

  </div>


</div>
